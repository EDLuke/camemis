<?
////////////////////////////////////////////////////////////////////////////////
// @Kaom Vibolrith Senior Software Developer
// Date: 01.05.2014
// Am Stollheen 18, 55120 Mainz, Germany
////////////////////////////////////////////////////////////////////////////////
require_once 'clients/CamemisPage.php';
require_once 'clients/CamemisBar.php';
require_once 'include/Common.inc.php';
require_once setUserLoacalization();

$CAMEMIS_PAGE_OBJECT = CamemisPage::getInstance();

print $CAMEMIS_PAGE_OBJECT->showCamemisHeader();

$setParams = "";
$setParams .="&subjectId=".$subjectObject->SUBJECT_ID."";
$setParams .="&academicId=".$this->academicId."";
$setParams .="&term=".$term."";
$setParams .="&section=".$section."";

?>

<style>
 @media screen and (-webkit-min-device-pixel-ratio:0) { 
    .x-grid3-cell, /* Normal grid cell */
    .x-grid3-gcell /* Grouped grid cell (esp. in head)*/
    {
        box-sizing: border-box;
    }
}
</style>

<script>
Ext.onReady(function() {
    var fields = [],
    columns = [],
    assignmentGroupRow = [];
    
    var assignmentGroupRow = [
        {header: '&nbsp;', colspan: 1, align: 'center'},
        {header: '&nbsp;', colspan: 1, align: 'center'},
        {header: 'Result', colspan: 1, align: 'center'},
        {header: 'Assessment', colspan: 1, align: 'center'},
        {header: 'Assignment #1', colspan: 2, align: 'center'},
        {header: 'Assignment #2', colspan: 2, align: 'center'},
        {header: 'Assignemnt #3', colspan: 2, align: 'center'},
        {header: 'Assignment #4', colspan: 2, align: 'center'},
        {header: 'Assignment #5', colspan: 2, align: 'center'},
        {header: 'Assignment #6', colspan: 1, align: 'center'}
    ]
     
    var group = new Ext.ux.grid.ColumnHeaderGroup({
        rows: [assignmentGroupRow]
    });
    
    //fields at this point is:
    var fields =  [
        {name: 'ID'},
        {name: 'STUDENT'},
        {name: 'RESULT'},
        {name: 'ASSESSMENT'},
        {name: 'A11'},
        {name: 'A12'},
        {name: 'B11'},
        {name: 'B12'},
        {name: 'C11'},
        {name: 'C12'},
        {name: 'D11'},
        {name: 'D12'},
        {name: 'E11'},
        {name: 'E12'},
        {name: 'A61'}
    ];
      
    // columns at this point is:
    var columns = [
        new Ext.grid.RowNumberer(),
        {dataIndex: 'STUDENT', header: 'Fullname', width:140},
        {dataIndex: 'RESULT', header: '&nbsp;', width: 80 ,align: 'center'},
        {dataIndex: 'ASSESSMENT', header: '&nbsp;', width: 100 ,align: 'center'},
        {dataIndex: 'A11', header: '10.05.2013' , width: 80 ,align: 'center'},
        {dataIndex: 'A12', header: '20.07.2013' , width: 80 ,align: 'center'},
        {dataIndex: 'B11', header: '10.05.2013' , width: 80 ,align: 'center'},
        {dataIndex: 'B12', header: '20.07.2013' , width: 80 ,align: 'center'},
        {dataIndex: 'C11', header: '10.05.2013' , width: 80 ,align: 'center'},
        {dataIndex: 'C12', header: '20.07.2013' , width: 80 ,align: 'center'},
        {dataIndex: 'D11', header: '10.05.2013' , width: 80 ,align: 'center'},
        {dataIndex: 'D12', header: '20.07.2013' , width: 80 ,align: 'center'},
        {dataIndex: 'E11', header: '10.05.2013' , width: 80 ,align: 'center'},
        {dataIndex: 'E12', header: '20.07.2013' , width: 80 ,align: 'center'},
        {dataIndex: 'A61', header: 'Leer' , width: 100 ,align: 'center'}
    ];
    
    var myStore = new Ext.data.Store({
        proxy: new Ext.data.HttpProxy({url:'/evaluation/jsonload/', method: 'POST'})
        ,baseParams:{
            start:0
            ,limit:100
            ,cmd:'jsonSubjectTermResult'
            ,camIds: '<?=$this->urlEncryp->encryptedGet($setParams)?>'
        }
        ,reader:new Ext.data.JsonReader({
            id:'NAME'
            ,totalProperty:'totalCount'
            ,root:'rows'
            ,fields:fields
        })
    });
    var grid = new Ext.grid.GridPanel({
        tbar:[{
            text:'ssss'
        }]
        ,border:false
        ,store: myStore
        ,columns: columns
        ,viewConfig: {
            forceFit: false
        }
        ,plugins: group
        ,bbar:new Ext.PagingToolbar({
            store:myStore
            ,displayInfo:true
            ,pageSize:100
        })
    });
    grid.store.reload();
    
    viewport = new Ext.Viewport({
        layout: 'fit'
        ,border: false
        ,items:[{
            layout:'fit'
            ,border: false
            ,items:[grid]
        }]
    });
});
</script>

<?
print $CAMEMIS_PAGE_OBJECT->showCamemisFooter();
?>