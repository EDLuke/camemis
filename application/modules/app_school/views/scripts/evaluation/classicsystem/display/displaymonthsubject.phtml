<?
///////////////////////////////////////////////////////////
// @Kaom Vibolrith Senior Software Developer
// Date: 18.07.2009
// Am Stollheen 18, 55120 Mainz, Germany
///////////////////////////////////////////////////////////
require_once 'clients/CamemisPage.php';
require_once 'clients/CamemisTree.php';
require_once 'clients/CamemisGrid.php';
require_once 'clients/CamemisBar.php';
require_once 'include/Common.inc.php';
require_once 'models/app_school/subject/GradeSubjectDBAccess.php';
require_once setUserLoacalization();

$CAMEMIS_PAGE_OBJECT = CamemisPage::getInstance();

$OBJECT_GRID = new CamemisGrid("STUDENT_EVALUATION", "LIST");
$OBJECT_GRID->setLoadUrl('/evaluation/jsonload/');

$columndata = Utiles::getGridColumnData("SUBJECT_EVALUATION_LIST_ID");

$studentId = isset($_GET["studentId"])?$_GET["studentId"]:"";

$academicObject = AcademicDBAccess::findGradeFromId($this->academicId);
$studentObject = StudentDBAccess::findStudentFromId($studentId);

if(!$academicObject && !$studentObject) {header("Location: /main/permission/");}

print $CAMEMIS_PAGE_OBJECT->showCamemisHeader();
?>
<script>
var behaviorValue;
Ext.onReady(function() {

    function textNormal(v, p, record, rowIndex){
        return String.format('<div class=\"x-grid3-cell-inner\" style=\"white-space:normal; font-weight:normal; height:15px; padding: 5px;color:#555 !important;\">{0}</div>'
            ,v
        );
    }

    function textBold(v, p, record, rowIndex){
        return String.format('<div class=\"x-grid3-cell-inner\" style=\"white-space:normal; font-weight:bold; height:15px; padding: 5px;color:#1861A5 !important;\">{0}</div>'
            ,v
        );
    }

    <?
    $OBJECT_GRID->addReadField("name: 'ASSIGNMENT'");
    $OBJECT_GRID->addReadField("name: 'POINTS'");
    $OBJECT_GRID->addReadField("name: 'CREATED_DATE'");
    $OBJECT_GRID->addReadField("name: 'TEACHER_COMMENTS'");
    $OBJECT_GRID->addReadField("name: 'STYLE_COLOR'");
    $OBJECT_GRID->addReadField("name: 'STYLE_COLOR_FONT'");

    $OBJECT_GRID->addColumn("header: '<b>".ASSIGNMENT."</b>', width: 200, renderer: textBold, dataIndex: 'ASSIGNMENT'");
    $OBJECT_GRID->addColumn("header: '<b>".CREATED_DATE."</b>', align: 'left', width: 150, renderer:textNormal, dataIndex: 'CREATED_DATE'");
    $OBJECT_GRID->addColumn("header: '<b>".POINTS."</b>', align: 'left', width: 100, renderer:textBold, dataIndex: 'POINTS'");
    $OBJECT_GRID->addColumn("header: '<b>".TEACHER_COMMENTS."</b>', align: 'left', width: 300, renderer:textNormal, dataIndex: 'TEACHER_COMMENTS'");

    $OBJECT_GRID->addTBarItems("
        tbar.add([{
            text: '" . CANCEL . "'
            ,iconCls:'icon-cancel'
            ,handler: function(){
                window.parent.Ext.getCmp('content').getLayout().setActiveItem(0);
            }
        }]);
    ");

    $OBJECT_GRID->addTBarItems("
        tbar.add([{
            text: '" . REFRESH . "'
            ,iconCls:'icon-reload'
            ,handler: function(){
                Ext.getCmp('" . $OBJECT_GRID->getObjectId() . "').store.reload();
            }
        }]);
    ");

    $setParams = "";
    $setParams .= "&academicId=".$academicObject->ID."";
    $setParams .= "&monthyear=".$this->monthyear."";
    $setParams .= "&subjectId=".$this->subjectId."";
    $setParams .= "&studentId=".$studentId."";
    
    $OBJECT_GRID->baseParams = "
        start:0
        ,limit:100
        ,cmd: 'jsonStudentGradebookMonth'
        ,camIds: '".$this->urlEncryp->encryptedGet($setParams)."'
    ";

    $OBJECT_GRID->loadMask = false;
    $OBJECT_GRID->isGroupingView = true;
    $OBJECT_GRID->groupField = "ASSIGNMENT";
    $OBJECT_GRID->forceFit = "false";
    $OBJECT_GRID->renderJS();

    $viewport = "";
    $viewport .= "viewport = new Ext.Viewport({";
        $viewport .= "layout: 'fit'";
        $viewport .= ",border: false";
        $viewport .= ",items:[{";
            $viewport .= "layout:'fit'";
            $viewport .= ",border: false";
            $viewport .= ",items:[{xtype: '".$OBJECT_GRID->getObjectXtype()."'}]";
        $viewport .= "}]";
    $viewport .= "});";
    echo $viewport;
    ?>
});
</script>
<?
print $CAMEMIS_PAGE_OBJECT->showCamemisFooter();
?>