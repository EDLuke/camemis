<?
////////////////////////////////////////////////////////////////////////////////
// @Kaom Vibolrith Senior Software Developer
// Date: 18.07.2009
// Am Stollheen 18, 55120 Mainz, Germany
////////////////////////////////////////////////////////////////////////////////
require_once 'clients/CamemisNvd3Chart.php';
require_once 'clients/CamemisPage.php';
require_once 'include/Common.inc.php';
require_once setUserLoacalization();

Zend_Loader::loadClass('Zend_Json');

$CAMEMIS_PAGE_OBJECT = CamemisPage::getInstance();
print $CAMEMIS_PAGE_OBJECT->showCamemisHeader();

$setId = isset($_GET['setId'])?addText($_GET['setId']):"";

if(!$setId) {header("Location: /main/permission/");}

if (strpos($setId, '264288bfbd819aac292ce2ee2e01d87d') !== false) {
    
    require_once 'models/app_school/evaluation/default/StudentSubjectAssessment.php';
    
    $stringExplode = explode('264288bfbd819aac292ce2ee2e01d87d',$setId);
    
    $explode = explode('_',$stringExplode[1]);
    $classId = $explode[0];
    $subjectId = $explode[1];
    $studentId = $explode[2];
    $monthList = AcademicDBAccess::getAcademicMonthList($classId);
    
    $STUDENT_ASSESSMENT = StudentSubjectAssessment::getInstance();
    $STUDENT_ASSESSMENT->studentId = $studentId;
    $STUDENT_ASSESSMENT->classId = $classId;
    $STUDENT_ASSESSMENT->subjectId = $subjectId;
    
    $data = array();
    if($monthList){
        $i=0;
        foreach($monthList as $key=>$value){
            
            $STUDENT_ASSESSMENT->month = getMonthNumberFromMonthYear($key."_".$value);
            $STUDENT_ASSESSMENT->year = getYearFromMonthYear($key."_".$value);
            $average = $STUDENT_ASSESSMENT->getAverageSubjectMonth();
            
            if($average){
                $data[$i]= "['".constant($key)." (".$value.")"."' , ".$average->SUBJECT_VALUE."]";
                ++$i;
            }
        }  
    }
    
    $result = "[{
        'key' : '".SCORE."'
        ,'values' : [ ".implode(',',$data)."]
    }]
    ";
    
    $CAMEMIS_CHART = new CamemisNvd3Chart('LineChart',$result);
    
} elseif (strpos($setId, 'ef11c24a5618a200ed2ae068509b326e') !== false) {
    
    //
}elseif (strpos($setId, 'ef11c24a5618a200ed21e068509b326e') !== false) {
    
    //
}elseif (strpos($setId, 'ef11c24a5618a200ed2we068509b326e') !== false) {
    
    //
}elseif (strpos($setId, 'ef11c24a5618a200ed2xe068509b326e') !== false) {
    
    //
}else{
    {header("Location: /main/permission/");}
}

$CAMEMIS_CHART->inCludeJs();

?>
<script>
    <?
    $CAMEMIS_CHART->renderJS();
    ?>
</script>
<div id="displayId">
  <div id="displayId"><svg style='width: 570px; height:230px;'></svg></div>
</div>
<?
print $CAMEMIS_PAGE_OBJECT->showCamemisFooter();
?>