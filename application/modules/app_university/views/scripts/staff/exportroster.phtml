<?///////////////////////////////////////////////////////////// @Hahn Stephen Software Developer// Date: 27.08.2010///////////////////////////////////////////////////////////require_once 'excel/phpexcel/Classes/PHPExcel.php';require_once 'excel/phpexcel/Classes/PHPExcel/IOFactory.php';require_once 'clients/CamemisExcelReport.php';require_once setUserLoacalization();$DB_STAFF = StaffDBAccess::getInstance();$db_grade = AcademicDBAccess::getInstance();$db_schoolyear = AcademicDateDBAccess::getInstance();$params["code"] = isset($_GET["code"])?$_GET["code"]:"";$params["firstname"] = isset($_GET["firstname"])?$_GET["firstname"]:"";$params["lastname"] = isset($_GET["lastname"])?$_GET["lastname"]:"";$params["gender"] = isset($_GET["gender"])?$_GET["gender"]:"";$params["searchJobtype"] = isset($_GET["searchJobtype"])?$_GET["searchJobtype"]:"";$params["searchUserRole"] = isset($_GET["searchUserRole"])?$_GET["searchUserRole"]:"";$params["choosegrade"] = isset($_GET["choosegrade"])?$_GET["choosegrade"]:"";$params["subjectId"] = isset($_GET["subjectId"])? (int)$_GET["subjectId"]:"";$params["staff_school_id"] = isset($_GET["staff_school_id"])?$_GET["staff_school_id"]:"";$rows = $DB_STAFF->searchStaffs($params, false);$entries = Array();for ($i = 0; $i < count($rows); $i++) {    $entries[$i]["NUMBER"] = $i + 1;     $entries[$i]["STAFF_SCHOOL_ID"] = $rows[$i]["STAFF_SCHOOL_ID"];    $entries[$i]["CODE"] = $rows[$i]["CODE"];    $entries[$i]["LASTNAME"] = $rows[$i]["LASTNAME"];    $entries[$i]["FIRSTNAME"] = $rows[$i]["FIRSTNAME"];    $entries[$i]["GENDER"] = $rows[$i]["GENDER_NAME"];    $entries[$i]["RELIGION"] = $rows[$i]["RELIGION"];    $entries[$i]["ETHNIC"] = $rows[$i]["ETHNIC"];    $entries[$i]["INSTRUCTOR"] = $rows[$i]["INSTRUCTOR"];    $entries[$i]["USER_ROLE"] = $rows[$i]["USER_ROLE"];    $entries[$i]["JOB_TYPE"] = $rows[$i]["JOB_TYPE"];    $entries[$i]["PHONE"] = $rows[$i]["PHONE"];    $entries[$i]["EMAIL"] = $rows[$i]["EMAIL"];    $entries[$i]["STREET"] = $rows[$i]["STREET"];    $entries[$i]["TOWN_CITY"] = $rows[$i]["TOWN_CITY"];    $entries[$i]["POSTCODE_ZIPCODE"] = $rows[$i]["POSTCODE_ZIPCODE"];    $entries[$i]["COUNTRY_PROVINCE"] = $rows[$i]["COUNTRY_PROVINCE"];    $entries[$i]["COUNTRY"] = $rows[$i]["COUNTRY"];}$columns[] = "NUMBER";$columns[] = "STAFF_SCHOOL_ID";$columns[] = "CODE";$columns[] = "LASTNAME";$columns[] = "FIRSTNAME";$columns[] = "GENDER";$columns[] = "RELIGION";$columns[] = "ETHNIC";$columns[] = "USER_ROLE";$columns[] = "INSTRUCTOR";$columns[] = "JOB_TYPE";$columns[] = "PHONE";$columns[] = "EMAIL";$columns[] = "STREET";$columns[] = "TOWN_CITY";$columns[] = "POSTCODE_ZIPCODE";$columns[] = "COUNTRY_PROVINCE";$columns[] = "COUNTRY";$ShowColumns[] = "Nr.";$ShowColumns[] = STAFF_SCHOOL_ID;$ShowColumns[] = CODE_ID;$ShowColumns[] = LASTNAME;$ShowColumns[] = FIRSTNAME;$ShowColumns[] = GENDER;$ShowColumns[] = RELIGION;$ShowColumns[] = ETHNIC_GROUPS;$ShowColumns[] = USER_ROLE;$ShowColumns[] = IN_CLASS;$ShowColumns[] = JOB_TYPE;$ShowColumns[] = PHONE;$ShowColumns[] = EMAIL;$ShowColumns[] = STREET;$ShowColumns[] = TOWN_CITY;$ShowColumns[] = POSTCODE_ZIPCODE;$ShowColumns[] = COUNTRY_PROVINCE;$ShowColumns[] = COUNTRY;$CamemisExcelReport = CamemisExcelReport::GetInstance();$CamemisExcelReport->iHeaderRowStart = 4;$CamemisExcelReport->iRowStart = 5;$objPHPExcel = $CamemisExcelReport -> createExcelObject($columns, $ShowColumns, $entries, null, false, true);$TITLE = FULL_STAFF_ROSTER;if ($params["choosegrade"])    $classObject = $db_grade->findObjectClassFromId($params["choosegrade"]);if (isset($classObject->SCHOOL_YEAR) && $classObject->SCHOOL_YEAR)    $schoolyearObject = $db_schoolyear->findAcademicDateFromId($classObject->SCHOOL_YEAR);if (isset($classObject->CAMPUS_ID) && $classObject->CAMPUS_ID)    $CAMPUS_OBJECT = $db_grade->findObjectClassFromId($classObject->CAMPUS_ID);if (isset($classObject->GRADE_ID) && $classObject->GRADE_ID)    $gradeObject = $db_grade->findObjectClassFromId($classObject->GRADE_ID);$SCHOOL_INFO = setShowText(Zend_Registry::get('SCHOOL')->NAME);$SCHOOL_INFO .= "\n" . ADDRESS . " : " . setShowText(Zend_Registry::get('SCHOOL')->ADDRESS);$SCHOOL_INFO .= "\n" . PHONE . " : " . setShowText(Zend_Registry::get('SCHOOL')->PHONE);$SCHOOL_INFO .= "\n" . EMAIL . " : " . setShowText(Zend_Registry::get('SCHOOL')->EMAIL);if ($params["choosegrade"]) {    $CLASS_INFO = "";    switch ($classObject->OBJECT_TYPE) {        case "CLASS":            $CLASS_INFO .= CAMPUS . " : " . setShowText($CAMPUS_OBJECT->NAME);            $CLASS_INFO .= "\n" . GRADE . " : " . setShowText($gradeObject->NAME);            $CLASS_INFO .= "\n" . SCHOOL_YEAR . " : " . setShowText($schoolyearObject->NAME);            $CLASS_INFO .= "\n" . GROUP . " : " . setShowText($classObject->NAME);            break;        case "SCHOOLYEAR":            $CLASS_INFO .= CAMPUS . " : " . setShowText($CAMPUS_OBJECT->NAME);            $CLASS_INFO .= "\n" . GRADE . " : " . setShowText($gradeObject->NAME);            $CLASS_INFO .= "\n" . SCHOOL_YEAR . " : " . setShowText($classObject->NAME);            break;        default :            break;    }}$DATE_INFO = DATE . " : " . getShowDate(getCurrentDBDate());$objPHPExcel->getActiveSheet()->setCellValue("A1", $SCHOOL_INFO);$objPHPExcel->getActiveSheet()->mergeCells("A1:R1");$CamemisExcelReport->createTitle($TITLE, "F", 2, "A");if ($params["choosegrade"]){    $objPHPExcel->getActiveSheet()->setCellValue("A3", $CLASS_INFO);    $objPHPExcel->getActiveSheet()->mergeCells("A3:E3");}$objPHPExcel->getActiveSheet()->setCellValue("F3", $DATE_INFO);$objPHPExcel->getActiveSheet()->mergeCells("F3:G3");$objPHPExcel->getActiveSheet()->getRowDimension(1)->setRowHeight(70);$objPHPExcel->getActiveSheet()->getRowDimension(2)->setRowHeight(70);$objPHPExcel->getActiveSheet()->getRowDimension(3)->setRowHeight(70);$style = array(    'alignment' => array(        'vertical' => PHPExcel_Style_Alignment::VERTICAL_TOP    ));$objPHPExcel->getActiveSheet()->getStyle("A3:R3")->applyFromArray($style);$filename = "Staff_Roster";$CamemisExcelReport->createSignatureField();header("Content-Type: application/x-msexcel; name=\"".$filename.".xls\"");header("Content-Disposition: attachment; filename=\"".$filename.".xls\"");// IE <= 6 cache fixheader('Expires: 0');header('Pragma: cache');header('Cache-Control: private');$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel5');$objWriter->save('php://output');?>