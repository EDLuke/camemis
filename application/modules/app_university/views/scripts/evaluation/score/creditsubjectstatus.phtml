<?
require_once 'clients/CamemisPage.php';
require_once 'clients/CamemisField.php';
require_once 'clients/CamemisBar.php';
require_once 'clients/CamemisForm.php';
require_once 'include/Common.inc.php';
require_once 'utiles/Utiles.php';
require_once 'models/UserAuth.php';
require_once setUserLoacalization();

$CAMEMIS_PAGE_OBJECT = CamemisPage::getInstance();

print $CAMEMIS_PAGE_OBJECT->showCamemisHeader();

$academicObject = AcademicDBAccess::findGradeFromId($this->academicId);
if(!$academicObject) {header("Location: /main/permission/");exit;}

$TERM_NUMBER = AcademicDBAccess::findAcademicTerm($academicObject->SCHOOL_YEAR);

$CATEGORY_GROUP_ROW ="[";
    $CATEGORY_GROUP_ROW .="{header: '&nbsp;', colspan: 1, align: 'center'}";
    $CATEGORY_GROUP_ROW .=",{header: '&nbsp;', colspan: 1, align: 'center'}";
    $CATEGORY_GROUP_ROW .=",{header: '&nbsp;', colspan: 1, align: 'center'}";
    
    switch($TERM_NUMBER){
        case 1:
            $CATEGORY_GROUP_ROW .=",{header: '<b>".FIRST_TERM."</b>', colspan: 3, align: 'center'}";
            $CATEGORY_GROUP_ROW .=",{header: '<b>".SECOND_TERM."</b>', colspan: 3, align: 'center'}";
            $CATEGORY_GROUP_ROW .=",{header: '<b>".THIRD_TERM."</b>', colspan: 3, align: 'center'}";
            break;
        case 2:
            $CATEGORY_GROUP_ROW .=",{header: '<b>".FIRST_QUARTER."</b>', colspan: 3, align: 'center'}";
            $CATEGORY_GROUP_ROW .=",{header: '<b>".SECOND_QUARTER."</b>', colspan: 3, align: 'center'}";
            $CATEGORY_GROUP_ROW .=",{header: '<b>".THIRD_QUARTER."</b>', colspan: 3, align: 'center'}";
            $CATEGORY_GROUP_ROW .=",{header: '<b>".FOURTH_QUARTER."</b>', colspan: 3, align: 'center'}";
            break;
        default:
            $CATEGORY_GROUP_ROW .=",{header: '<b>".FIRST_SEMESTER."</b>', colspan: 3, align: 'center'}";
            $CATEGORY_GROUP_ROW .=",{header: '<b>".SECOND_SEMESTER."</b>', colspan: 3, align: 'center'}";
            break;
    }
    
    $CATEGORY_GROUP_ROW .=",{header: '<b>".YEAR."</b>', colspan: 3, align: 'center'}";
    
$CATEGORY_GROUP_ROW .="]";

$COLUMNS ="[";

    $COLUMNS .="{dataIndex: 'FULL_NAME', header: '<b>".FULL_NAME."</b>', width:140},";
    $COLUMNS .="{dataIndex: 'GENDER', header: '<b>".GENDER."</b>', width: 80 ,align: 'center'},";
    $COLUMNS .="{dataIndex: 'DATE_BIRTH', header: '<b>".DATE_BIRTH."', width: 110 ,align: 'center'},";
    
    switch($TERM_NUMBER){
        case 1:
            $COLUMNS .="{dataIndex: 'FIRST_NUMBER_CREDIT', header: '<b>".NUMBER_CREDIT."</b>' , width: 110 ,align: 'center'},";
            $COLUMNS .="{dataIndex: 'FIRST_LEARNING_OUTCOMES', header: '<b>".LEARNING_OUTCOMES."</b>' , width: 110 ,align: 'center'},";
            $COLUMNS .="{dataIndex: 'FIRST_CREDIT_STATUS', header: '<b>".STATUS."</b>' , width: 110 ,align: 'center'},";

            $COLUMNS .="{dataIndex: 'SECOND_NUMBER_CREDIT', header: '<b>".NUMBER_CREDIT."</b>' , width: 110 ,align: 'center'},";
            $COLUMNS .="{dataIndex: 'SECOND_LEARNING_OUTCOMES', header: '<b>".LEARNING_OUTCOMES."</b>' , width: 110 ,align: 'center'},";
            $COLUMNS .="{dataIndex: 'SECOND_CREDIT_STATUS', header: '<b>".STATUS."</b>' , width: 110 ,align: 'center'},";
            
            $COLUMNS .="{dataIndex: 'THIRD_NUMBER_CREDIT', header: '<b>".NUMBER_CREDIT."</b>' , width: 110 ,align: 'center'},";
            $COLUMNS .="{dataIndex: 'THIRD_LEARNING_OUTCOMES', header: '<b>".LEARNING_OUTCOMES."</b>' , width: 110 ,align: 'center'},";
            $COLUMNS .="{dataIndex: 'THIRD_CREDIT_STATUS', header: '<b>".STATUS."</b>' , width: 110 ,align: 'center'},";

            $COLUMNS .="{dataIndex: 'YEAR_NUMBER_CREDIT', header: '<b>".NUMBER_CREDIT."</b>' , width: 110 ,align: 'center'},";
            $COLUMNS .="{dataIndex: 'YEAR_LEARNING_OUTCOMES', header: '<b>".LEARNING_OUTCOMES."</b>' , width: 110 ,align: 'center'},";
            $COLUMNS .="{dataIndex: 'YEAR_CREDIT_STATUS', header: '<b>".STATUS."</b>' , width: 110 ,align: 'center'}";
            break;
        case 2:
            $COLUMNS .="{dataIndex: 'FIRST_NUMBER_CREDIT', header: '<b>".NUMBER_CREDIT."</b>' , width: 110 ,align: 'center'},";
            $COLUMNS .="{dataIndex: 'FIRST_LEARNING_OUTCOMES', header: '<b>".LEARNING_OUTCOMES."</b>' , width: 110 ,align: 'center'},";
            $COLUMNS .="{dataIndex: 'FIRST_CREDIT_STATUS', header: '<b>".STATUS."</b>' , width: 110 ,align: 'center'},";

            $COLUMNS .="{dataIndex: 'SECOND_NUMBER_CREDIT', header: '<b>".NUMBER_CREDIT."</b>' , width: 110 ,align: 'center'},";
            $COLUMNS .="{dataIndex: 'SECOND_LEARNING_OUTCOMES', header: '<b>".LEARNING_OUTCOMES."</b>' , width: 110 ,align: 'center'},";
            $COLUMNS .="{dataIndex: 'SECOND_CREDIT_STATUS', header: '<b>".STATUS."</b>' , width: 110 ,align: 'center'},";
            
            $COLUMNS .="{dataIndex: 'THIRD_NUMBER_CREDIT', header: '<b>".NUMBER_CREDIT."</b>' , width: 110 ,align: 'center'},";
            $COLUMNS .="{dataIndex: 'THIRD_LEARNING_OUTCOMES', header: '<b>".LEARNING_OUTCOMES."</b>' , width: 110 ,align: 'center'},";
            $COLUMNS .="{dataIndex: 'THIRD_CREDIT_STATUS', header: '<b>".STATUS."</b>' , width: 110 ,align: 'center'},";

            $COLUMNS .="{dataIndex: 'FOURTH_NUMBER_CREDIT', header: '<b>".NUMBER_CREDIT."</b>' , width: 110 ,align: 'center'},";
            $COLUMNS .="{dataIndex: 'FOURTH_LEARNING_OUTCOMES', header: '<b>".LEARNING_OUTCOMES."</b>' , width: 110 ,align: 'center'},";
            $COLUMNS .="{dataIndex: 'FOURTH_CREDIT_STATUS', header: '<b>".STATUS."</b>' , width: 110 ,align: 'center'}";
            
            $COLUMNS .="{dataIndex: 'YEAR_NUMBER_CREDIT', header: '<b>".NUMBER_CREDIT."</b>' , width: 110 ,align: 'center'},";
            $COLUMNS .="{dataIndex: 'YEAR_LEARNING_OUTCOMES', header: '<b>".LEARNING_OUTCOMES."</b>' , width: 110 ,align: 'center'},";
            $COLUMNS .="{dataIndex: 'YEAR_CREDIT_STATUS', header: '<b>".STATUS."</b>' , width: 110 ,align: 'center'}";
            break;
        default:
            $COLUMNS .="{dataIndex: 'FIRST_NUMBER_CREDIT', header: '<b>".NUMBER_CREDIT."</b>' , width: 110 ,align: 'center'},";
            $COLUMNS .="{dataIndex: 'FIRST_LEARNING_OUTCOMES', header: '<b>".LEARNING_OUTCOMES."</b>' , width: 110 ,align: 'center'},";
            $COLUMNS .="{dataIndex: 'FIRST_CREDIT_STATUS', header: '<b>".STATUS."</b>' , width: 110 ,align: 'center'},";

            $COLUMNS .="{dataIndex: 'SECOND_NUMBER_CREDIT', header: '<b>".NUMBER_CREDIT."</b>' , width: 110 ,align: 'center'},";
            $COLUMNS .="{dataIndex: 'SECOND_LEARNING_OUTCOMES', header: '<b>".LEARNING_OUTCOMES."</b>' , width: 110 ,align: 'center'},";
            $COLUMNS .="{dataIndex: 'SECOND_CREDIT_STATUS', header: '<b>".STATUS."</b>' , width: 110 ,align: 'center'},";

            $COLUMNS .="{dataIndex: 'YEAR_NUMBER_CREDIT', header: '<b>".NUMBER_CREDIT."</b>' , width: 110 ,align: 'center'},";
            $COLUMNS .="{dataIndex: 'YEAR_LEARNING_OUTCOMES', header: '<b>".LEARNING_OUTCOMES."</b>' , width: 110 ,align: 'center'},";
            $COLUMNS .="{dataIndex: 'YEAR_CREDIT_STATUS', header: '<b>".STATUS."</b>' , width: 110 ,align: 'center'}";
            break;
    }
    
$COLUMNS .="]";

$FIELDS ="[";
    $FIELDS .="{name: 'FULL_NAME'}";
    $FIELDS .=",{name: 'GENDER'}";
    $FIELDS .=",{name: 'DATE_BIRTH'}";
    switch($TERM_NUMBER){
        case 1:
            $FIELDS .=",{name: 'FIRST_NUMBER_CREDIT'}";
            $FIELDS .=",{name: 'FIRST_LEARNING_OUTCOMES'}";
            $FIELDS .=",{name: 'FIRST_CREDIT_STATUS'}";
            $FIELDS .=",{name: 'SECOND_NUMBER_CREDIT'}";
            $FIELDS .=",{name: 'SECOND_LEARNING_OUTCOMES'}";
            $FIELDS .=",{name: 'SECOND_CREDIT_STATUS'}";
            $FIELDS .=",{name: 'THIRD_NUMBER_CREDIT'}";
            $FIELDS .=",{name: 'THIRD_LEARNING_OUTCOMES'}";
            $FIELDS .=",{name: 'THIRD_CREDIT_STATUS'}";
            $FIELDS .=",{name: 'YEAR_NUMBER_CREDIT'}";
            $FIELDS .=",{name: 'YEAR_LEARNING_OUTCOMES'}";
            $FIELDS .=",{name: 'YEAR_CREDIT_STATUS'}";
            break;
        case 2:
            $FIELDS .=",{name: 'FIRST_NUMBER_CREDIT'}";
            $FIELDS .=",{name: 'FIRST_LEARNING_OUTCOMES'}";
            $FIELDS .=",{name: 'FIRST_CREDIT_STATUS'}";
            $FIELDS .=",{name: 'SECOND_NUMBER_CREDIT'}";
            $FIELDS .=",{name: 'SECOND_LEARNING_OUTCOMES'}";
            $FIELDS .=",{name: 'SECOND_CREDIT_STATUS'}";
            $FIELDS .=",{name: 'THIRD_NUMBER_CREDIT'}";
            $FIELDS .=",{name: 'THIRD_LEARNING_OUTCOMES'}";
            $FIELDS .=",{name: 'THIRD_CREDIT_STATUS'}";
            $FIELDS .=",{name: 'FOURTH_NUMBER_CREDIT'}";
            $FIELDS .=",{name: 'FOURTH_LEARNING_OUTCOMES'}";
            $FIELDS .=",{name: 'FOURTH_CREDIT_STATUS'}";
            $FIELDS .=",{name: 'YEAR_NUMBER_CREDIT'}";
            $FIELDS .=",{name: 'YEAR_LEARNING_OUTCOMES'}";
            $FIELDS .=",{name: 'YEAR_CREDIT_STATUS'}";
            break;
        default:
            $FIELDS .=",{name: 'FIRST_NUMBER_CREDIT'}";
            $FIELDS .=",{name: 'FIRST_LEARNING_OUTCOMES'}";
            $FIELDS .=",{name: 'FIRST_CREDIT_STATUS'}";
            $FIELDS .=",{name: 'SECOND_NUMBER_CREDIT'}";
            $FIELDS .=",{name: 'SECOND_LEARNING_OUTCOMES'}";
            $FIELDS .=",{name: 'SECOND_CREDIT_STATUS'}";
            $FIELDS .=",{name: 'YEAR_NUMBER_CREDIT'}";
            $FIELDS .=",{name: 'YEAR_LEARNING_OUTCOMES'}";
            $FIELDS .=",{name: 'YEAR_CREDIT_STATUS'}";
            break;
    }
$FIELDS .="]";
?>
<style>
 @media screen and (-webkit-min-device-pixel-ratio:0) { 
    .x-grid3-cell, /* Normal grid cell */
    .x-grid3-gcell /* Grouped grid cell (esp. in head)*/
    {
        box-sizing: border-box;
    }
}
</style>

<script>
Ext.onReady(function() {
    var fields = [],
    columns = [],
    categoryGroupRow = [];

    // assignmentGroupRow at this point is:
    var categoryGroupRow = <?=$CATEGORY_GROUP_ROW;?>;

    var group = new Ext.ux.grid.ColumnHeaderGroup({
        rows: [categoryGroupRow]
    });

    //fields at this point is:
    var fields = <?=$FIELDS;?>;
    // columns at this point is:
    var columns = <?=$COLUMNS;?>;
    
    var grid = new Ext.grid.GridPanel({
        border:false
        ,store: new Ext.data.Store({
            proxy: new Ext.data.HttpProxy({url:'/evaluation/jsonload/', method: 'POST'})
            ,baseParams:{academicId:'123'}
            ,reader:new Ext.data.JsonReader({
                id:'NAME'
                ,totalProperty:'totalCount'
                ,root:'rows'
                ,fields:[
                    {name: 'ID'}
                    ,fields
                ]
            })
        }),
//        store: new Ext.data.ArrayStore({
//            fields: fields,
//            data: data
//        }),
        columns: columns,
        viewConfig: {
            forceFit: false
        },
        plugins: group
        ,tbar:[{
            text:'<?=REFRESH?>'
            ,iconCls:'icon-reload'
        }]
    });
    
    viewport = new Ext.Viewport({
        layout: 'fit'
        ,border: false
        ,items:[{
            layout:'fit'
            ,border: false
            ,items:[grid]
        }]
    });
});
</script>

<?
print $CAMEMIS_PAGE_OBJECT->showCamemisFooter();
?>