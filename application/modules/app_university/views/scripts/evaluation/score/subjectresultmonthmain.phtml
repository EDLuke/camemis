<?
////////////////////////////////////////////////////////////////////////////////
// @Kaom Vibolrith Senior Software Developer
// Date: 18.04.2014
// Am Stollheen 18, 55120 Mainz, Germany
////////////////////////////////////////////////////////////////////////////////
require_once 'clients/CamemisPage.php';
require_once 'clients/CamemisTree.php';
require_once 'clients/CamemisGrid.php';
require_once 'clients/CamemisBar.php';
require_once 'include/Common.inc.php';
require_once setUserLoacalization();

$CAMEMIS_PAGE_OBJECT = CamemisPage::getInstance();

$OBJECT_GRID = new CamemisGrid("SUBJECT_EVALUATION", "LIST");
$OBJECT_GRID->setLoadUrl('/evaluation/jsonload/');
$OBJECT_GRID->setSaveUrl('/evaluation/jsonsave/');

$academicId = isset($_GET["academicId"])? (int) $_GET["academicId"]:"";
$subjectObject = SubjectDBAccess::getAcademicSubject($this->subjectId, $academicId);

$academicObject = AcademicDBAccess::findGradeFromId($academicId);

if(!$academicObject && !$subjectObject) {header("Location: /main/permission/");}

$monthList = AcademicDBAccess::getAcademicMonthList($academicObject->ID);

$data = array();
if($monthList){
    foreach($monthList as $key=>$value){
        $setParams = "&section=1&subjectId=".$this->subjectId."&academicId=".$academicId."&monthyear=".$key."_".$value."";
        $ITEMS = "{";
            $ITEMS .= "title:'".constant($key)." (".$value.")'";
            $ITEMS .= ",border:false";
            $ITEMS .= ",layout:'fit'";
            $ITEMS .= ",items:[new Ext.ux.IFrameComponent({ id: '".$key."_".$value."', url: '/evaluation/subjectresultmonth/?camIds=".$this->urlEncryp->encryptedGet($setParams)."'})]";
        $ITEMS .= "}";
        $data[] = $ITEMS;
    }  
}

if($data){
    $TAB_ITEMS = implode(",",$data);
}else{
    $TAB_ITEMS = "{";
        $TAB_ITEMS .= "title:'".NOT_AVAILABLE."'";
        $TAB_ITEMS .= ",id:'NOT_AVAILABLE'";
        $TAB_ITEMS .= ",border:false";
        $TAB_ITEMS .= ",layout:'fit'";
        $TAB_ITEMS .= ",html:'".NOT_AVAILABLE."'";
    $TAB_ITEMS .= "}";
}

print $CAMEMIS_PAGE_OBJECT->showCamemisHeader();
?>
<style>
    .x-vr-tab-panel-bwrap {
        background: none repeat scroll 0 0 <?=CamemisPage::userBgColor();?>;
        border-left: 1px solid #99BBE8;
        float: right;
        padding: 3px;
    }
</style>
<script>
Ext.onReady(function() {
    
    <?
    $CAMEMIS_PAGE_OBJECT->setCostumerCSS();
    $CAMEMIS_PAGE_OBJECT->setExtDefaultGif();
    
    ?>
    viewport = new Ext.Viewport({
        layout: 'fit'
        ,border: false
        ,items:[{
            xtype: 'vrtabpanel'				
            ,activeTab: 0
            ,enableTabScroll:true       
            ,defaults: {autoScroll:true}
            ,items:[<?=$TAB_ITEMS;?>]
        }]
    });
});
</script>
<?
print $CAMEMIS_PAGE_OBJECT->showCamemisFooter();
?>