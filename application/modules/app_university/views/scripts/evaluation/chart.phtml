<?

///////////////////////////////////////////////////////////
// @THORN Visal
// Date: 01.08.2014
///////////////////////////////////////////////////////////
require_once 'clients/CamemisHighChart.php';
require_once 'clients/CamemisPage.php';
require_once 'models/assessment/AssessmentChart.php';
require_once setUserLoacalization();

$target = isset($_GET["target"]) ? addText($_GET["target"]) : "";
$studentId = isset($_GET["studentId"]) ? addText($_GET["studentId"]) : "";
$academicId = isset($_GET["academicId"]) ? addText($_GET["academicId"]) : "";
$subjectId = isset($_GET["subjectId"]) ? addText($_GET["subjectId"]) : "";
$term = isset($_GET["term"]) ? addText($_GET["term"]) : "";
$section = isset($_GET["section"]) ? addText($_GET["section"]) : "";

if($term){
    switch($term){
        case "FIRST_SEMESTER":
            $section ="2";
            break;
        case "SECOND_SEMESTER":
            $section ="2";
            break;
        case "FIRST_TERM":
            $section ="4";
            break;
        case "SECOND_TERM":
            $section ="4";
            break;
        case "THIRD_TERM":
            $section ="4";
            break;
        case "FIRST_QUARTER":
            $section ="5";
            break;
        case "SECOND_QUARTER":
            $section ="5";
            break;
        case "THIRD_QUARTER":
            $section ="5";
            break;
        case "FOURTH_QUARTER":
            $section ="5";
        break;
    }
}



$CAMEMIS_PAGE_OBJECT = CamemisPage::getInstance();

print $CAMEMIS_PAGE_OBJECT->showCamemisHeader();

CamemisHighChart::setHighChartLIB();

Class DisplayChart{
    
    function __construct($_target, $_academicId, $_subjectId, $_term, $_section, $_studentId) {
        
        $this->target = strtoupper($_target);
        $this->academicId = $_academicId;
        $this->subjectId = $_subjectId;
        $this->term = $_term;
        $this->section = $_section;
        $this->studentId = $_studentId;
        
        $this->chart = new AssessmentChart();
        $this->chart->setAcademicId($this->academicId);
        $this->chart->setSubjectId($this->section);
        $this->chart->setTerm($this->term);
    }
    
    protected function setDefaultChart(){
        $SUBJECT_GRADINGSCALE = new CamemisHighChart(
            "PIC_CHART"
            , 'SUBJECT_GRADINGSCALE'
            , 'All Grading Scale of Students'
            , $this->chart->getSubjectGradingScaleByClass()
        );

        $SUBJECT_GRADINGSCALE->allowPointSelect = 'true';
        $SUBJECT_GRADINGSCALE->pointColor = 'black';
        $SUBJECT_GRADINGSCALE->height = 300;
        $SUBJECT_GRADINGSCALE->maxWidth = 450;
        $SUBJECT_GRADINGSCALE->maxWidthPercentage = false;
        $SUBJECT_GRADINGSCALE->plotBorderWidth = "null";

        $SUBJECT_PASS_STATUS = new CamemisHighChart(
            "COLUMN_COMPARE_CHART"
            , 'SUBJECT_PASS_STATUS'
            , 'Pass/Fail Status'
            , $this->chart->getSubjectPassStatus()
        );

        $SUBJECT_PASS_STATUS->allowPointSelect = 'true';
        $SUBJECT_PASS_STATUS->pointColor = 'black';
        $SUBJECT_PASS_STATUS->height = 400;
        $SUBJECT_PASS_STATUS->maxWidth = 450;
        $SUBJECT_PASS_STATUS->maxWidthPercentage = false;
        $SUBJECT_PASS_STATUS->plotBorderWidth = "null";
        $SUBJECT_PASS_STATUS->xAxis = "{categories:['" . PASS . "','" . FAIL . "']}";

        $SUBJECT_AVG_STUDENT_LIST = new CamemisHighChart(
            "COLUMN_CHART", 'SUBJECT_AVG_STUDENT_LIST'
            , 'List of Students Average'
            , $this->chart->getSubjectAVGStudentList()
        );
        $SUBJECT_AVG_STUDENT_LIST->text = false;
        $SUBJECT_AVG_STUDENT_LIST->allowPointSelect = 'true';
        $SUBJECT_AVG_STUDENT_LIST->pointColor = 'black';
        $SUBJECT_AVG_STUDENT_LIST->height = 400;
        $SUBJECT_AVG_STUDENT_LIST->maxWidthPercentage = true;
        $SUBJECT_AVG_STUDENT_LIST->plotBorderWidth = "null";

        $SUBJECT_GRADINGSCALE->setDIVHighChart();
        $SUBJECT_PASS_STATUS->setDIVHighChart();
        $SUBJECT_AVG_STUDENT_LIST->setDIVHighChart();

        $SUBJECT_GRADINGSCALE->setHighChartScript();
        $SUBJECT_PASS_STATUS->setHighChartScript();
        $SUBJECT_AVG_STUDENT_LIST->setHighChartScript();
    }

    protected function getTeacherEnterScoreChart(){
        
        $dataset = "[{
            name: 'Assignment1',
            data: [3, 4, 3, 5, 4, 10, 12]
        },{
            name: 'Assignment2',
            data: [1, 3, 4, 3, 3, 5, 4]
        }]";
    
        $CHART = new CamemisHighChart(
            "AREA_SPLINE_CHART"
            , 'TEACHER_ENTER_SCORE'
            , TEACHER_ENTER_SCORE
            , $dataset
        );
        $CHART->xAxis ="categories: ['Date1','Date2','Date3','Date4','Date5','Date6','Date7']";
        $CHART->allowPointSelect = 'true';
        $CHART->plotBorderWidth = "null";
        $CHART->setDIVHighChart();
        $CHART->setHighChartScript();
    }
    
    public function setDisplayChart(){
        switch($this->target){
            case "TEACHER_ENTER_SCORE":
                return $this->getTeacherEnterScoreChart();
            break;
            default:
                return $this->setDefaultChart();
            break;
        }
    }
}

$DISPLAY = new DisplayChart($target, $academicId, $subjectId, $term, $section, $studentId);
$DISPLAY->setDisplayChart();

print $CAMEMIS_PAGE_OBJECT->showCamemisFooter();
?>
